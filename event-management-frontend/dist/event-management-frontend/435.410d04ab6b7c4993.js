"use strict";(self.webpackChunkevent_management_frontend=self.webpackChunkevent_management_frontend||[]).push([[435],{2435:(P,p,m)=>{m.r(p),m.d(p,{CreateEventComponent:()=>$});var T=m(177),u=m(7062),c=m(5596),M=m(8834),C=m(9213),l=m(9417),_=m(882),E=m(9631),D=m(5416),e=m(7705),v=m(9486),y=m(4312);let $=(()=>{class f{constructor(a,i,t,r,n){this.eventService=a,this.router=i,this.authService=t,this.snackBar=r,this.route=n,this.form={title:"",description:"",startDateTime:"",endDateTime:"",location:"",maxAttendees:1,ticketPrice:0,imageUrl:"",categoryId:1},this.fromAdminPanel=!1,this.isSubmitting=!1}toBackendDate(a){if(!a)return"";if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(a))return`${a}:00`;if(/^\d{4}-\d{2}-\d{2}$/.test(a))return`${a}T10:00:00`;let t=a.match(/^(\d{2})-(\d{2})-(\d{4})\s+(\d{2}):(\d{2})$/);if(t){const[,n,o,d,g,s]=t;return`${d}-${o}-${n}T${g}:${s}:00`}if(t=a.match(/^(\d{2})-(\d{2})-(\d{4})$/),t){const[,n,o,d]=t;return`${d}-${o}-${n}T10:00:00`}if(t=a.match(/^(\d{2})\/(\d{2})\/(\d{4})\s+(\d{2}):(\d{2})$/),t){const[,n,o,d,g,s]=t;return`${d}-${o}-${n}T${g}:${s}:00`}if(t=a.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),t){const[,n,o,d]=t;return`${d}-${o}-${n}T10:00:00`}const r=new Date(a);return isNaN(r.getTime())?"":(n=>{const o=b=>b.toString().padStart(2,"0");return`${n.getFullYear()}-${o(n.getMonth()+1)}-${o(n.getDate())}T${o(n.getHours())}:${o(n.getMinutes())}:00`})(r)}toInputLocal(a){const i=g=>g.toString().padStart(2,"0");return`${a.getFullYear()}-${i(a.getMonth()+1)}-${i(a.getDate())}T${i(a.getHours())}:${i(a.getMinutes())}`}ngOnInit(){this.fromAdminPanel="true"===this.route.snapshot.queryParamMap.get("admin");const i=new Date((new Date).getTime()+36e5),t=new Date(i.getTime()+72e5);this.form.startDateTime=this.toInputLocal(i),this.form.endDateTime=this.toInputLocal(t)}onSubmit(){if(this.isSubmitting)return;if(!this.authService.isAuthenticated())return this.snackBar.open("Please login to create an event.","Close",{duration:3e3}),void this.router.navigate(["/login"],{queryParams:{returnUrl:"/create-event"}});this.isSubmitting=!0;let a=this.toBackendDate(this.form.startDateTime),i=this.toBackendDate(this.form.endDateTime);const t=new Date(a);let r=new Date(i);if(isNaN(t.getTime()))return void(this.isSubmitting=!1);(isNaN(r.getTime())||r<=t)&&(r=new Date(t.getTime()+72e5),i=this.toInputLocal(r),this.form.endDateTime=i);const n=this.authService.isAdmin(),o={...this.form,startDateTime:a,endDateTime:i,maxAttendees:Number(this.form.maxAttendees),ticketPrice:Number(this.form.ticketPrice),categoryId:Number(this.form.categoryId),status:n&&this.fromAdminPanel?"PUBLISHED":void 0};(n&&this.fromAdminPanel?this.eventService.createEvent(o):this.eventService.submitEvent(o)).subscribe({next:()=>{this.isSubmitting=!1,this.snackBar.open(n?"Event created successfully.":"Event submitted for approval.","Close",{duration:3e3}),this.router.navigate(["/events"])},error:s=>{const h=s&&s.error&&(s.error.message||s.error.error||s.error)||"Failed to save event. Please check your inputs and try again.";console.error("Failed to create/submit event",s),this.snackBar.open(String(h),"Close",{duration:5e3}),this.isSubmitting=!1}})}static{this.\u0275fac=function(i){return new(i||f)(e.rXU(v.U),e.rXU(u.Ix),e.rXU(y.u),e.rXU(D.UG),e.rXU(u.nX))}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["app-create-event"]],standalone:!0,features:[e.aNF],decls:57,vars:12,consts:[[1,"container"],[3,"ngSubmit"],["f","ngForm"],[1,"grid"],["appearance","outline"],["matInput","","name","title","required","",3,"ngModel","ngModelChange"],["matInput","","name","description",3,"ngModel","ngModelChange"],["matInput","","type","datetime-local","name","startDateTime","required","",3,"ngModel","ngModelChange"],["matInput","","type","datetime-local","name","endDateTime","required","",3,"ngModel","min","ngModelChange"],["matInput","","name","location","required","",3,"ngModel","ngModelChange"],["matInput","","type","number","name","maxAttendees","min","1","required","",3,"ngModel","ngModelChange"],["matInput","","type","number","step","0.01","name","ticketPrice","required","",3,"ngModel","ngModelChange"],["matInput","","name","imageUrl",3,"ngModel","ngModelChange"],["matInput","","type","number","name","categoryId","required","",3,"ngModel","ngModelChange"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-button","","routerLink","/my-events"]],template:function(i,t){if(1&i&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2,"Create Event"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Create a new event for your community"),e.k0s(),e.j41(5,"mat-card")(6,"form",1,2),e.bIt("ngSubmit",function(){return t.onSubmit()}),e.j41(8,"mat-card-content")(9,"div",3)(10,"mat-form-field",4)(11,"mat-label"),e.EFF(12,"Title"),e.k0s(),e.j41(13,"input",5),e.bIt("ngModelChange",function(n){return t.form.title=n}),e.k0s()(),e.j41(14,"mat-form-field",4)(15,"mat-label"),e.EFF(16,"Description"),e.k0s(),e.j41(17,"textarea",6),e.bIt("ngModelChange",function(n){return t.form.description=n}),e.k0s()(),e.j41(18,"mat-form-field",4)(19,"mat-label"),e.EFF(20,"Start Date & Time"),e.k0s(),e.j41(21,"input",7),e.bIt("ngModelChange",function(n){return t.form.startDateTime=n}),e.k0s(),e.j41(22,"mat-hint"),e.EFF(23,"Use the picker; required format is YYYY-MM-DDTHH:mm"),e.k0s()(),e.j41(24,"mat-form-field",4)(25,"mat-label"),e.EFF(26,"End Date & Time"),e.k0s(),e.j41(27,"input",8),e.bIt("ngModelChange",function(n){return t.form.endDateTime=n}),e.k0s(),e.j41(28,"mat-hint"),e.EFF(29,"Use the picker; required format is YYYY-MM-DDTHH:mm"),e.k0s()(),e.j41(30,"mat-form-field",4)(31,"mat-label"),e.EFF(32,"Location"),e.k0s(),e.j41(33,"input",9),e.bIt("ngModelChange",function(n){return t.form.location=n}),e.k0s()(),e.j41(34,"mat-form-field",4)(35,"mat-label"),e.EFF(36,"Max Attendees"),e.k0s(),e.j41(37,"input",10),e.bIt("ngModelChange",function(n){return t.form.maxAttendees=n}),e.k0s()(),e.j41(38,"mat-form-field",4)(39,"mat-label"),e.EFF(40,"Ticket Price"),e.k0s(),e.j41(41,"input",11),e.bIt("ngModelChange",function(n){return t.form.ticketPrice=n}),e.k0s()(),e.j41(42,"mat-form-field",4)(43,"mat-label"),e.EFF(44,"Image URL"),e.k0s(),e.j41(45,"input",12),e.bIt("ngModelChange",function(n){return t.form.imageUrl=n}),e.k0s()(),e.j41(46,"mat-form-field",4)(47,"mat-label"),e.EFF(48,"Category ID"),e.k0s(),e.j41(49,"input",13),e.bIt("ngModelChange",function(n){return t.form.categoryId=n}),e.k0s()()()(),e.j41(50,"mat-card-actions")(51,"button",14)(52,"mat-icon"),e.EFF(53,"save"),e.k0s(),e.EFF(54),e.k0s(),e.j41(55,"button",15),e.EFF(56," Cancel "),e.k0s()()()()()),2&i){const r=e.sdS(7);e.R7$(13),e.Y8G("ngModel",t.form.title),e.R7$(4),e.Y8G("ngModel",t.form.description),e.R7$(4),e.Y8G("ngModel",t.form.startDateTime),e.R7$(6),e.Y8G("ngModel",t.form.endDateTime)("min",t.form.startDateTime),e.R7$(6),e.Y8G("ngModel",t.form.location),e.R7$(4),e.Y8G("ngModel",t.form.maxAttendees),e.R7$(4),e.Y8G("ngModel",t.form.ticketPrice),e.R7$(4),e.Y8G("ngModel",t.form.imageUrl),e.R7$(4),e.Y8G("ngModel",t.form.categoryId),e.R7$(2),e.Y8G("disabled",r.invalid||t.isSubmitting),e.R7$(3),e.SpI(" ",t.isSubmitting?"Creating...":"Create Event"," ")}},dependencies:[T.MD,u.iI,u.Wk,l.YN,l.qT,l.me,l.Q0,l.BC,l.cb,l.YS,l.VZ,l.vS,l.cV,c.Hu,c.RN,c.YY,c.m2,M.Hl,M.$z,C.m_,C.An,_.RG,_.rl,_.nJ,_.MV,E.fS,E.fg,D._T],styles:[".container[_ngcontent-%COMP%]{padding:40px 20px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}"]})}}return f})()}}]);